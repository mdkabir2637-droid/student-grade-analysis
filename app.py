# -*- coding: utf-8 -*-
"""student_grade_analysis.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1EWyKKbgxKA9l-h2hR_6mqCUJd3uxik_7
"""

import streamlit as st
import matplotlib.pyplot as plt
import pandas as pd

st.title("Student Grade Analysis Using Python")
st.subheader("Capstone Project - Data Analytics")

num_students = st.number_input(
    "Enter number of students",
    min_value=1,
    step=1
)

students = []

if st.button("Generate Input Fields"):
    for i in range(int(num_students)):
        st.markdown(f"### Student {i+1}")

        roll = st.text_input(f"Roll Number {i+1}", key=f"roll{i}")
        name = st.text_input(f"Student Name {i+1}", key=f"name{i}")

        marks = st.number_input(
            f"Marks of Student {i+1}",
            min_value=0,
            max_value=100,
            key=f"marks{i}"
        )

        students.append({
            "Roll No": roll,
            "Name": name,
            "Marks": marks
        })

    if st.button("Generate Result"):
        df = pd.DataFrame(students)

        df["Percentage"] = df["Marks"]
        df["CGPA"] = df["Percentage"] / 10

        def grade(p):
            if p >= 90:
                return "A+"
            elif p >= 80:
                return "A"
            elif p >= 70:
                return "B"
            elif p >= 60:
                return "C"
            else:
                return "Fail"

        df["Grade"] = df["Percentage"].apply(grade)

        st.subheader("Student Result Table")
        st.dataframe(df)

        # Topper & Lowest
        topper = df.loc[df["Percentage"].idxmax()]
        lowest = df.loc[df["Percentage"].idxmin()]

        st.success(f"üèÜ Topper: {topper['Name']} ({topper['Percentage']}%)")
        st.error(f"‚¨á Lowest: {lowest['Name']} ({lowest['Percentage']}%)")

        # Bar Chart
        st.subheader("Marks Comparison")
        fig, ax = plt.subplots()
        ax.bar(df["Name"], df["Percentage"])
        ax.set_ylabel("Percentage")
        ax.set_xlabel("Students")
        st.pyplot(fig)

        # Pie Chart
        st.subheader("Grade Distribution")
        grade_count = df["Grade"].value_counts()
        fig2, ax2 = plt.subplots()
        ax2.pie(grade_count, labels=grade_count.index, autopct="%1.1f%%")
        st.pyplot(fig2)


