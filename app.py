# -*- coding: utf-8 -*-
"""student_grade_analysis.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1EWyKKbgxKA9l-h2hR_6mqCUJd3uxik_7
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

st.title("Student Grade Analysis Using Python")
st.subheader("Capstone Project â€“ Data Analytics")

# Initialize session state
if "generated" not in st.session_state:
    st.session_state.generated = False

if "students" not in st.session_state:
    st.session_state.students = []

num_students = st.number_input(
    "Enter number of students",
    min_value=1,
    step=1
)

if st.button("Generate Input Fields"):
    st.session_state.students = []
    for i in range(num_students):
        st.session_state.students.append({
            "roll": "",
            "name": "",
            "marks": 0
        })
    st.session_state.generated = True

# Show inputs only AFTER button click
if st.session_state.generated:
    st.markdown("### Enter Student Details")

    for i in range(num_students):
        st.markdown(f"#### Student {i+1}")
        st.session_state.students[i]["roll"] = st.text_input(
            f"Roll Number {i+1}",
            key=f"roll_{i}"
        )
        st.session_state.students[i]["name"] = st.text_input(
            f"Student Name {i+1}",
            key=f"name_{i}"
        )
        st.session_state.students[i]["marks"] = st.number_input(
            f"Marks {i+1}",
            min_value=0,
            max_value=100,
            key=f"marks_{i}"
        )

    if st.button("Generate Result"):
        df = pd.DataFrame(st.session_state.students)

        df["Percentage"] = df["marks"]
        df["Grade"] = df["Percentage"].apply(
            lambda x: "A" if x >= 75 else "B" if x >= 60 else "C" if x >= 40 else "F"
        )

        st.markdown("## Result Table")
        st.dataframe(df)

        st.markdown("## Marks Bar Graph")
        fig, ax = plt.subplots()
        ax.bar(df["name"], df["marks"])
        ax.set_ylabel("Marks")
        ax.set_xlabel("Student Name")
        st.pyplot(fig)

        st.markdown("## Grade Distribution (Pie Chart)")
        grade_count = df["Grade"].value_counts()
        fig2, ax2 = plt.subplots()
        ax2.pie(grade_count, labels=grade_count.index, autopct="%1.1f%%")
        st.pyplot(fig2)
